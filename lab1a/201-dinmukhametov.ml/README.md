 # Блокирующий TCP чат

Написан на Kotlin.

## Протокол

Подразумевает последовательность действий.

1. *Login* — Самое первое сообщение. Но может быть и в любой момент после, это просто изменит имя пользователя, но при этом сервер не разрешит поменять имя на уже занятое

1. *Message* — В любой момент после *Login*, но до *Logout*. В сообщении можно передавать файл или текст. Сообщение содержит время и хэш сумму

1. *Logout* — Последнее сообщение, после него сервер разрывает соединение с клиентов и удаляет имя из мапы

### Формат пакета:

1. Первые 4 байта выделяются на общий размер пакета

1. 1 байт выделяется для типа сообщения (*Login*, *Logout*, *Message*)

1. Данные в json формате

    * Если тип сообщения *Login*, *Logout*, то единственное поле `name`
    
    * Если тип сообщения *Message*, то поля `name`, `isFile`, `data`, `sha256` и `date` 

    `data` — это строка закодированная в Base64, что позволяет передавать файлы и строки в этом поле
    
    `sha256` — Хэш сумма `data`
    
    `date` — Хранит время в *UTC-0*. Клиент при получении сообщения сам устанавливает свой часовой пояс

## Клиент

1. При старте просим ввести имя пользователя

1. Для отправки файла нужно ввести *file:**Путь до файла***

1. При получении файла файл сохраняется с рандомным UUID

1. Чтобы выйти нужно ввести *\logout* или просто закрыть клиент 

## Асинхронный сервер

Чтобы запустить асинхронный сервер нужно установить в файле *config.properties* значение `isAsinc=true`. 

Сервера по большей части используют общую логику.

Отличие заключается в том, что теперь нам не нужно останавливаться пока мы ждем сообщение от пользователя

## Build

Для сборки использовалась Openjdk 11.0.13 

Сервер:

```sh
gradle :server:build
```

Клиент:

```sh
gradle :client:build
```

## Запуск

Сервер:

```sh
java -jar server/build/libs/server-1.0.jar
```

Клиент:

```sh
java -jar client/build/libs/client-1.0.jar
```

## Репозиторий

https://github.com/maratdin7/client-server