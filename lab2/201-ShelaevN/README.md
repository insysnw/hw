
# Реальные UDP протоколы

## TFTP-клиент

Написан на Python (3.7)

Проверялся с помощью приложения / сервиса `Tftpd64` [Скачать его можно здесь](https://github.com/peacepenguin/tftpd64/releases)

### Запуск

`python TFTP_client.py`

### Протокол

TFTP (Trivial File Transfer Protocol — простой протокол передачи файлов) используется главным образом для первоначальной загрузки бездисковых рабочих станций.
TFTP, в отличие от FTP, не содержит возможностей аутентификации (хотя возможна фильтрация по IP-адресу) и основан на транспортном протоколе UDP

Любой TFTP-пакет начинается с поля, размером в 2 байта, определяющим тип пакета:

1). Read Request (RRQ) — запрос на чтение файла   
2). Write Request (WRQ) — запрос на запись файла   
3). Data (DATA) — данные, передаваемые через TFTP   
4). Acknowledgment (ACK) — подтверждение пакета   
5). Error (ERR) — ошибка при передаче   
6). Option Acknowledgment (OACK) — подтверждение опций (сервером)

Формат всех типов пакета можно посмотреть в файле `TFTP_client.py`

В TFTP существует 2 режима передачи (режим `mail` признан устаревшим):

1. `netascii` — файл перед передачей перекодируется в ASCII   
2. `octet` — файл передается без изменений (байты)

После получения **RRQ**-пакета сервером, он сразу начинает передачу данных.   
В случае с **WRQ**-запросом — сервер должен прислать **ACK**-пакет c номером пакета **0**

Используется 69-й порт

Описание протокола: [RFC 1350](https://datatracker.ietf.org/doc/html/rfc1350)   
Описание дополнительных опций: [RFC 2347](https://datatracker.ietf.org/doc/html/rfc2347), [RFC 2348](https://datatracker.ietf.org/doc/html/rfc2348) и 
[RFC 2349](https://datatracker.ietf.org/doc/html/rfc2349)

### Команды

Клиент должен использовать следующиий вид команды: `R/W Filename Mode`

`R/W`: `-w`, `--write` или `write` - отправка файла (**WRQ**), `-r`, `--read` или `read` - получение файла (**RRQ**)

`Filename` - название передаваемого файла

`Mode` - режим передачи (см. выше)

## DHCP-сервер

Написан на Python (3.7)

Проверялся с помощью DHCP-клиента

### Запуск

`python DHCP_server.py`

### Протокол

DHCP (Dynamic Host Configuration Protocol — протокол динамической настройки узла) — прикладной протокол, 
позволяющий сетевым устройствам автоматически получать IP-адрес и другие параметры, необходимые для работы в сети TCP/IP 

Протокол DHCP предоставляет три способа распределения IP-адресов:

1). **Ручное распределение**: сетевой администратор сопоставляет аппаратному адресу (MAC-адрес) каждого клиентского компьютера определённый IP-адрес   
2). **Автоматическое распределение**: каждому компьютеру на постоянное использование выделяется произвольный свободный IP-адрес из определённого администратором диапазона   
3). **Динамическое распределение**: аналогичен автоматическому распределению за исключением того, что адрес выдаётся компьютеру не на постоянное пользование, а на определённый срок (аренда адреса). 
По истечении срока аренды IP-адрес вновь считается свободным, и клиент обязан запросить новый. Кроме того, клиент сам может отказаться от полученного адреса

Помимо IP-адреса, DHCP также может сообщать клиенту дополнительные параметры (опции DHCP), необходимые для нормальной работы в сети. 
Список стандартных опций можно найти в [RFC 2132](https://datatracker.ietf.org/doc/html/rfc2132).

По умолчанию запросы от клиента делаются к серверу на порт 67, сервер в свою очередь отвечает клиенту на порт 68, выдавая  IP-адрес и другую необходимую информацию

Формат пакета можно посмотреть в файле `DHCP_server.py`

Описание протокола: [RFC 2131](https://datatracker.ietf.org/doc/html/rfc2131)

### Принцип работы:

Процесс получения IP состоит из 4-х этапов: **Discovery**, **Offer**, **Request** и **Acknowledgement**.

* **Discovery**: 

    Клиент рассылает широковещательный UDP-запрос (`DHCPDISCOVER`) по всей сети с целью обнаружить доступные DHCP-серверы и запросом для получения IP-адреса

    Клиент заполняет опции в пакете:
    * В поле `xid` записывается идентификатор транзакции, который должен быть уникальным для каждого пользователя. Данный идентификатор позволяет отличать процессы получения IP-адресов друг от друга   
    * В поле `chaddr` записывается аппаратный адрес (MAC-адрес) клиента

* **Offer**:

    Получив сообщение от клиента, сервер определяет требуемую конфигурацию клиента в соответствии с указанными сетевым администратором настройками. 
    Сервер отправляет ему ответ (`DHCPOFFER`), в котором предлагает конфигурацию. Предлагаемый клиенту IP-адрес указывается в поле `yiaddr`. 
    Прочие параметры указываются в виде опций в соответствующих полях.  

* **Request**:

    Выбрав одну из конфигураций, предложенных DHCP-серверами, клиент отправляет DHCP-запрос (`DHCPREQUEST`). 
    Он рассылается широковещательно, при этом к опциям, указанным клиентом в сообщении `DHCPDISCOVER`, добавляется идентификатор / адрес выбранного DHCP-сервера.

* **Acknowledgement**:

    Сервер, получивший `DHCPREQUEST`, отправляет пакет формата `DHCPACK`, в котором перечисляет сетевые настройки, предназначенные для данного клиента.

* Помимо сообщений, необходимых для первоначального получения IP-адреса клиентом, DHCP предусматривает несколько дополнительных сообщений для выполнения иных задач: 
`DHCPDECLINE` (Отказ DHCP), `DHCPNAK` (Отмена DHCP), `DHCPRELEASE` (Освобождение DHCP) и `DHCPINFORM`(Информация DHCP)